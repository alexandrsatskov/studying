# Своя музыка в такси


## Описание
Вы когда нибудь вставали к первой паре?.. Печальное чувство, правда? Теперь можно будет ехать на учебу/работу заряженным и позитивным! (но это не точно)  
Новая SUF (super useful feature), позволяет пользователям такси выбирать в качесте опции при заказе такси свой плейлист, и слушать его во время поездки!


## Гипотеза
1. В первую очередь просто классная идея как мне кажется, учитывая параболический рост кол-ва музыки и ее производных в последние десятилетия.
Больше позитивных оценок, как пользователю, так и водителю.  
\*В данном случае предполагается, что музыка содаст позитивную, дружескую атмосферу, **НО** только в том случае, если она устраивает обе стороны С:

2. Для бизнеса можно выделить следующие пункты:
    - Из-за, возможной, позитивной атмосферы пользователи захотят оставить чаевые водителю.
    - Опция очевидно будет платная, => $$$
    - Вырастет кол-во пользователей Я.Go => $$$
    - Очевидно, что функционал, по крайней мере, на первое время, нужно будет связать с Я.Музыка, => вырастет кол-во пользователей данного сервиса, => $$$
    - Скорее всего такое событие не пройдет мимо СМИ. Так что можно как-то сыграть и на этом.
    - (субъективно) У молодежи больше лояльности к Яндексу, из-за таких нестандартных идей.


## Реализация
По идее, вся реализация заключается в добавлении нового option к уже существующим.  
Полагаю что список option'ов уже корректно обрабатывается в сервисе, и, скорее всего, ничего не сломается если добавим еще один. Следовательно, практически ничего менять/дописывать не нужно.  
Единственная проблема - добавить в приложение для водителей плеер. Который ходит в плейлист клиента и берет оттуда следующий трек.  

**Что нужно сделать**  
  - Создать новый option при оформлении заказа в Я.Go: **self_playlist: bool = False**
  - Модифицируем БД водителей. Добавляем новую характеристику водителя: **loyal_to_client_music: bool = False** (если водитель не хочет чтобы клиент включал свою музыку, в таком случае он просто не попадает в выборку, при формировании заказа с **self_playlist = True**)
  - В приложении для водителя создать примитивный **плеер**, который будет ходить в Я.Музыка API и брать оттуда треки плейлиста клиента.
  - После положительного ответа на запрос в **/start_ride** (клиен сел в машину, поездка началась) создаем плеер с плейлистом клиента.
  - После положительного ответа на запрос в **/complete_ride** (поезка завершилась) удаляем/закрываем плеер  

> Я не знаю как там врунтри все устроено, поэтому последние два пункта могут быть неверными; для меня это выглядит примерно так:  
1. В Я.Go появляется новый option, клиент заказывает такси с новой фичей (делает POST запрос в Я.Go, полагаю), это будет ручка /create_order, она создает заказ
2. Дальше (Я.Go) передает созданный заказ в ручку /assign_order сервиса (Я.Водитель), внутри сервис назначает заказ на определенного водителя
3. (опустим все промежуточные состояния, условимся что клиент только что сел в машину)
4. Клиент садится в машину, водитель жмет кнопку в своем приложении <начать поездку>, тем самым отправляя запрос в ручку /start_ride, если получили в ответ 200 OK, то инициализируем плеер с плейлистом клиента.
5. Приехали на адрес клиента, водитель нажимает на кнопку <завершить поездку>, отправляя запрос в ручку /complete_ride, если получили 200 OK, то закрываем/удаляем плеер


## MVP
Можно обойтись первыми двумя пунктами из TODO, и не реализовывать плеер. В таком случае водителю нужно будет ручками открывать плейлист клиента и ручками запускать треки. Ссылку на плейлист можно засунуть в <информация о заказе>, думаю что-то подобное должно быть.


## Визуализация
![Схема](https://user-images.githubusercontent.com/56599235/124064524-a1f54c80-da3d-11eb-8e56-8f38b1a540d8.png)

## Тесты 
unit:  
1. Протестировать работу плеера  
2. Протестировать что инстанс плеера корректно создается и закрывается
3. Протестировать что плеер вообще работает 

corner case:  
1. У клиента может не быть Я.Музыки, тогда у него не должно быть возможности попробовать данную фичу  


## Как раскатываем
Включить для пользователей Я.Плюс кажется оптимальным вариантом - им приятно, что участвуют в alpha-тесте, нам - метрики. 
За чем следим:
1. Изменилось кол-во чаевых?
2. Люди стали ставить больше оценок?
3. Выросло кол-во пользователей/заказов?


## Итог  
\*Возвращаю студенческий долг. Первую ДЗ сделал по теме, которая меня особо не интересовала, а о том, чтобы придумать что-то свое даже в голову не пришло. В итоге получилось не особо качественно. Два ДЗ, так уже сделать совесть не позволяет, да и хочется получить какой-то полезный фидбек на свои попытки сделать что-то. Поэтому было принято решение сделать все с нуля, имея некоторые знания с уже прослушанных лекций. **Оригинал первого ДЗ вы найдете ниже**.  
  
\*\*[Ссылка на оригинальную фичу](https://github.com/YaBackSchool2021/homework1/pull/12/files?short_path=887975f#diff-887975fae30699d64776d263e337dafe316de8870f5ad12ddfec5966a2fac092)
